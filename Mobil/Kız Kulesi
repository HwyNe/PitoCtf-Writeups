# ğŸ—¼ KÄ±z Kulesi â€“ Mobile Challenge

## Platform

CTF YarÄ±ÅŸmasÄ±

## Zorluk

â­â­ Orta

## Kategori

ğŸ“± Mobil (Reverse Engineering)

## Puan

500 Puan (+50 Firstblood)

## Challenge DosyasÄ±

ğŸ“¥ **kizkulesi.apk** (Google Drive)

## AÃ§Ä±klama

Flagi emÃ¼latÃ¶rde bulduÄŸunuz ÅŸekilde aynen girmeniz gerekiyor. Ã–zel bir format eklenmemiÅŸtir.

---

## ğŸ› ï¸ KullanÄ±lan AraÃ§lar

* **apktool** â€“ APK decompile
* **grep** â€“ Smali ve XML iÃ§inde pattern arama
* **cat** â€“ Dosya okuma
* **Python 3** â€“ Script yazÄ±mÄ±
* **PyCryptodome** â€“ AES Ã§Ã¶zme
* **Linux Terminal** â€“ Analiz ortamÄ±

---

## ğŸ” Ã‡Ã¶zÃ¼m

### 1. APK Ä°ndirme ve Dosya KontrolÃ¼

```bash
wget "https://drive.google.com/uc?export=download&id=15XLNWR0yjFqcqeLWFzORll36NmVCANtr" -O kizkulesi.apk
file kizkulesi.apk
```

**Ã‡Ä±ktÄ±:**

```
Zip archive data
```

APK doÄŸrulandÄ±.

---

### 2. APK Decompile (apktool)

```bash
apktool d kizkulesi.apk -o kizkulesi_decompiled
cd kizkulesi_decompiled
```

**Ä°Ã§erik:**

* AndroidManifest.xml
* smali/
* smali_classes2/
* smali_classes3/
* res/

---

### 3. Encrypted String Analizi

```bash
cat res/values/strings.xml | grep -i encrypted
```

Bulunan Base64 stringler:

* encrypted_1
* encrypted_1_1
* encrypted_2
* encrypted_3

---

### 4. MainActivity.smali Ä°ncelemesi

```bash
cd smali_classes3/com/example/kizkulesi/
cat MainActivity.smali
```

**Ã–nemli Bulgular:**

* `areYouAtKizKulesi()` metodu **her zaman false** dÃ¶ndÃ¼rÃ¼yor
* Buna raÄŸmen flag iÅŸleme bloÄŸu Ã§alÄ±ÅŸÄ±yor

---

### 5. Flag Ä°ÅŸleme MantÄ±ÄŸÄ±

Smali analizine gÃ¶re:

* `encrypted_1` â†’ 3x Base64 decode â†’ `v0`
* `encrypted_2` â†’ 5x Base64 decode â†’ `v2`
* `encrypted_3` â†’ 4x Base64 decode â†’ `v3`
* `v6 = v0 + v2 + v3`

SonrasÄ±nda:

* AES/CBC/PKCS5Padding ile decrypt
* Key: `1234567890123456`
* IV: `0000000000000000`

---

### 6. Python Script ile Flag Ã‡Ã¶zme

```python
import base64
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad

enc1 = "VG1rNWRVOUhSa3hpUm1oT1VrWm5ORnBHY0ZwaU1uaERVMFZ6ZUZWUlBUMD0="
enc2 = "Vm14a2QxVXhWblJVYmtwVFlXeGFiMVZyWkc5amJGcFhWbXR3YkZacmJEVmFWVlpYVlcxRmVGZHVXbGRXZWtaMVZGUkdkMDB4UWxWTlJEQTk="
enc3 = "VmtSQk5XRldiRFZrU0VKcllsWktlVll3WkZaa01WSnhVV3BhYTFaVmIzaFdWM1JxVUZFOVBRPT0="

key = b"1234567890123456"
iv = bytes(16)

def multi_decode(data, n):
    for _ in range(n):
        data = base64.b64decode(data).decode()
    return data

v0 = multi_decode(enc1, 3)
v2 = multi_decode(enc2, 5)
v3 = multi_decode(enc3, 4)
v6 = v0 + v2 + v3

cipher = AES.new(key, AES.MODE_CBC, iv)
flag_inner = unpad(cipher.decrypt(base64.b64decode(v6)), 16).decode()

flag = "FLAG={HM2023-" + flag_inner + "}"
print(flag)
```

---

## ğŸš© Flag

```
FLAG={HM2023-561feccec11015b8be7ff470e15d5c1e}
```

---

## ğŸ“Š Ã‡Ã¶zÃ¼m AkÄ±ÅŸÄ±

```
ğŸ—¼ KÄ±z Kulesi Challenge
        â†“
ğŸ“± APK indirildi
        â†“
ğŸ”“ apktool ile decompile
        â†“
ğŸ” strings.xml â†’ encrypted veriler
        â†“
ğŸ“‚ MainActivity.smali analizi
        â†“
ğŸ”¢ Base64 decode zinciri
        â†“
ğŸ” AES decrypt
        â†“
ğŸš© FLAG elde edildi
```

---

## ğŸ§  Ã–ÄŸrenilenler

* Smali kodu flag mantÄ±ÄŸÄ±nÄ± tamamen ortaya Ã§Ä±karabilir
* Location/emulator kontrolleri bazen bilinÃ§li olarak bypass edilir
* Ã‡oklu Base64 + AES kombinasyonu mobil CTFâ€™lerde yaygÄ±ndÄ±r

---

## ğŸ’¡ Notlar

* EmÃ¼latÃ¶r ÅŸartÄ± misleading amaÃ§lÄ± eklenmiÅŸ
* Statik analiz ile tamamen Ã§Ã¶zÃ¼lebilir
* Hardcoded key ve IV ciddi gÃ¼venlik aÃ§Ä±ÄŸÄ±dÄ±r
